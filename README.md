# 🎨 Object Extractor

OpenAI APIを使用して画像からオブジェクトを検出し、個別の画像として再生成するStreamlitツールです。

## ✨ 機能

1. **🔍 オブジェクト検出**: GPT-4o with Visionを使用して画像内のオブジェクトとその位置を特定
2. **🎨 画像再生成**: gpt-image-1を使用して各オブジェクトを背景透過で単体生成
3. **🖥️ Web UI**: Streamlitによる直感的なユーザーインターフェース
4. **📥 ダウンロード機能**: 生成された画像をPNG形式でダウンロード可能
5. **⚙️ 詳細設定**: 品質（high/medium/low）とサイズ（正方形/縦長/横長）の選択
6. **✅ 選択式生成**: 必要なオブジェクトのみを選択して生成可能

## 🚀 セットアップ

### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2. OpenAI APIキーの準備

OpenAIのAPIキーが必要です。[OpenAI Platform](https://platform.openai.com/)でアカウントを作成し、APIキーを取得してください。

### 3. APIキーの設定

**方法A: ローカル開発（環境変数使用）**

`.env`ファイルを作成し、APIキーを設定：

```bash
LOCAL=1
OPENAI_API_KEY=your_actual_openai_api_key_here
```

**方法B: 本番環境（UI入力）**

環境変数 `LOCAL` を設定しない、または `LOCAL=1` 以外に設定した場合、アプリケーション起動後にUIでAPIキーを入力します。

**重要**: `.env`ファイルは`.gitignore`で除外済みです。実際のAPIキーをコミットしないでください。

### 4. アプリケーションの起動

```bash
streamlit run app.py
```

または

```bash
python -m streamlit run app.py
```

ブラウザで http://localhost:8501 にアクセスしてください。

## 📖 使用方法

### 基本的な流れ

1. **🔧 設定**
   - `LOCAL=1`の場合: 自動でAPIキーを読み込み
   - それ以外: サイドバーでAPIキーを入力

2. **⚙️ 画像生成設定**
   - 品質: `high`（高品質）/ `medium`（中品質）/ `low`（低品質）
   - サイズ: `1024x1024`（正方形）/ `1024x1536`（縦長）/ `1536x1024`（横長）

3. **📷 画像アップロード**
   - PNG、JPG、JPEG形式の画像をアップロード

4. **🔍 オブジェクト検出**
   - 「オブジェクトを検出」ボタンをクリック
   - 画像内のオブジェクトを日本語と英語で表示

5. **✅ オブジェクト選択**
   - 生成したいオブジェクトを個別に選択
   - 「全て選択」「全て解除」ボタンで一括操作

6. **🎨 画像生成**
   - 「選択したオブジェクトの画像を生成」ボタンをクリック
   - 進捗バーで生成状況を確認

7. **📥 ダウンロード**
   - 生成された各画像を個別にダウンロード可能

## 🔧 技術仕様

### 使用API
- **GPT-4o with Vision**: オブジェクト検出（JSON形式レスポンス）
- **gpt-image-1**: 画像生成（背景透過PNG）

### 対応フォーマット
- **入力**: PNG、JPG、JPEG
- **出力**: PNG（背景透過）

### 品質設定
- **High**: 最高品質（処理時間長、コスト高）
- **Medium**: 中品質（バランス型、推奨）
- **Low**: 低品質（処理時間短、コスト安）

## ⚠️ 注意事項

- OpenAI APIの使用料金が発生します
- 大量のオブジェクトがある画像では処理時間が長くなります
- API制限により、連続生成時に1秒の待機時間が設定されています
- 生成される画像は元の画像に忠実ですが、AI生成のため完全一致は保証されません

## 🛠️ 技術スタック

- **Python 3.7+**
- **Streamlit**: Webアプリケーション
- **OpenAI API**: オブジェクト検出・画像生成
- **PIL (Pillow)**: 画像処理
- **python-dotenv**: 環境変数管理